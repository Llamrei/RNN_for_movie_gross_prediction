#!/bin/bash
#debug:
#PBS -l select=1:ncpus=8:mem=24gb:ompthreads=8
# PBS -lselect=1:ncpus=8:mem=48gb:ngpus=1:gpu_type=RTX6000
#PBS -lwalltime=00:30:0
# PBS -J 1-2


echo "Started"
date

inter_threads=2
intra_threads=6
exp_vals=(mse-tfidf-core-l2)
# exp_vals=({'mse','mae','mape'}-{'tfidf','learned','bert'}-{'core','shallow_wide','deep_narrow','deep_wide'})
# no_exps="${#exp_vals[@]}"
job="${PBS_JOBID%[*}"
# array_idx=$(($PBS_ARRAY_INDEX - 1))

# For repeating experiments we want to cycle through our experiment values
# Important fact here is the same array index will give you the same experimental value
# so if we repeat an experiment multiple times it will always go to the same PBS_ARRAY_INDEX folder
# exp_idx=$(($array_idx % $no_exps))
# exp_val=${exp_vals[$exp_idx]}
exp_val=${exp_vals[0]}
# exp_counter=$(($array_idx / $no_exps))

input_data_path="$HOME/RNN_for_movie_gross_prediction/complete10000_films_and_synopsis.pickle"
script_dir="$HOME/RNN_for_movie_gross_prediction/jobs/mini_project_exps/"
# output_dir="$EPHEMERAL/mini_project_exps/$job/$exp_val/$exp_counter"
output_dir="$EPHEMERAL/mini_project_exps/$PBS_JOBNAME/$job"

mkdir -p $output_dir
cd $script_dir

module load anaconda3/personal
module load cuda
source activate tf2-w-text
python experiment.py "$output_dir" "$input_data_path" "$exp_val" "$intra_threads" "$inter_threads" &>"$output_dir/stdout"

echo "Done"
date